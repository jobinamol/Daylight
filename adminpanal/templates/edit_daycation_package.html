{% extends 'adminindex.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4 text-center">Edit Daycation Package</h1>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="bg-white p-4 rounded shadow">
        {% csrf_token %}
        <div class="mb-3">
            <label for="name" class="form-label">Package Name</label>
            <input type="text" class="form-control" id="name" name="name" value="{{ package.name }}" required>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" rows="3" required>{{ package.description }}</textarea>
        </div>
        <div class="mb-3">
            <label for="price" class="form-label">Price</label>
            <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{ package.price }}" required>
        </div>
        <div class="mb-3">
            <label for="duration" class="form-label">Duration</label>
            <input type="text" class="form-control" id="duration" name="duration" value="{{ package.duration }}" required>
        </div>
        <div class="mb-3">
            <label for="max_capacity" class="form-label">Max Capacity</label>
            <input type="number" class="form-control" id="max_capacity" name="max_capacity" value="{{ package.max_capacity }}" required>
        </div>
        <div class="mb-3">
            <label for="category" class="form-label">Category</label>
            <select class="form-select" id="category" name="category" required>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if category.id == package.category.id %}selected{% endif %}>{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="image" class="form-label">Package Image</label>
            <input type="file" class="form-control" id="image" name="image">
            {% if package.image %}
            <img src="{{ package.image.url }}" alt="{{ package.name }}" class="img-thumbnail mt-2" style="max-width: 200px;">
            {% endif %}
        </div>
        
        <h3 class="mt-4">Features</h3>
        <div id="features">
            {% for feature in package.features.all %}
            <div class="mb-2">
                <input type="text" class="form-control" name="features[]" value="{{ feature.name }}" placeholder="Feature">
            </div>
            {% endfor %}
        </div>
        <button type="button" class="btn btn-secondary mb-3" onclick="addFeature()">Add Feature</button>

        <h3 class="mt-4">Add-ons</h3>
        <div id="addons">
            {% for addon in package.addons.all %}
            <div class="mb-3">
                <input type="text" class="form-control mb-2" name="addon_name[]" value="{{ addon.name }}" placeholder="Add-on Name">
                <input type="number" step="0.01" class="form-control mb-2" name="addon_price[]" value="{{ addon.price }}" placeholder="Add-on Price">
                <textarea class="form-control" name="addon_description[]" placeholder="Add-on Description" rows="2">{{ addon.description }}</textarea>
            </div>
            {% endfor %}
        </div>
        <button type="button" class="btn btn-secondary mb-3" onclick="addAddon()">Add Add-on</button>

        <div class="text-center">
            <button type="submit" class="btn btn-primary btn-lg mt-4">Update Package</button>
        </div>
    </form>
</div>

<script>
function addFeature() {
    const featuresDiv = document.getElementById('features');
    const newFeature = document.createElement('div');
    newFeature.className = 'mb-2';
    newFeature.innerHTML = '<input type="text" class="form-control" name="features[]" placeholder="Feature">';
    featuresDiv.appendChild(newFeature);
}

function addAddon() {
    const addonsDiv = document.getElementById('addons');
    const newAddon = document.createElement('div');
    newAddon.className = 'mb-3';
    newAddon.innerHTML = `
        <input type="text" class="form-control mb-2" name="addon_name[]" placeholder="Add-on Name">
        <input type="number" step="0.01" class="form-control mb-2" name="addon_price[]" placeholder="Add-on Price">
        <textarea class="form-control" name="addon_description[]" placeholder="Add-on Description" rows="2"></textarea>
    `;
    addonsDiv.appendChild(newAddon);
}
</script>
{% endblock %}
